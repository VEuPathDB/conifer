#!/usr/bin/perl

my $branch = $ARGV[0];

usage() unless ($branch);

my @projects = ('ApiCommonData:apidb', 'ApiCommonShared:apidb', 'ApiCommonWorkflow:apidb', 'CBIL:gus', 'DoTS:apidb', 'EuPathDatasets:apidb', 'FgpUtil:gus', 'GGTools:apidb', 'GusAppFramework:gus', 'GusSchema:gus', 'install:gus', 'OrthoMCLData:apidb', 'OrthoMCLEngine:apidb', 'OrthoMCLShared:apidb', 'ReFlow:gus', 'WDK:gus');

my $url = 'https://www.cbil.upenn.edu/svn';
foreach my $project (@projects) {
  my ($name, $repository) = split(/:/, $project);
  my $target = "$url/$repository/$name/branches/$branch";
  my $dirName = $name;
  $dirName = "GUS" if $dirName eq 'GusAppFramework';
  my $cmd = "svn co $target $dirName";
  print STDERR "$name\n";
  system($cmd) == 0 || die "Failed branching '$name'\n";
}

sub usage {
  die "
usage: fgpBackendCheckout branch_number
";
}
