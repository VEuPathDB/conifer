#!/usr/bin/perl
use strict;
use Cwd;
my ($branch) = @ARGV;

usage() unless $branch;

my $projectHomeDir = getcwd();
my @dirs = map {chomp; $_} `ls`;

foreach my $dir (@dirs) {
  my $svnName = $dir;
  $svnName = "GusAppFramework" if $dir eq "GUS";

  chdir("$projectHomeDir/$dir") || die "Error: Can't chdir into '$projectHomeDir/$dir'\n";
  print STDERR "cd $dir\n";
  my $target = $branch eq 'trunk'? "trunk" : "branches/$branch";
  my $cmd = "svn switch ^/$svnName/$target";
  print STDERR "$cmd\n";
  system($cmd) && die "Failed\n";
}


sub usage {
  print STDERR "
Perform svn switch on the directories in a \$PROJECT_HOME.

Usage: fgpSwitch trunk|my_branch_name

Where:
  trunk|my_branch_name:  where you will switch to

BEFORE you do this operation:
  1. cd to the \$PROJECT_HOME you want to switch
  2. svn up *

";
exit(1);
}
