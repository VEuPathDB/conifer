#!/usr/bin/perl
use strict;
my $branch = $ARGV[0];
my $target = $ARGV[1];

my @sharedProjects = ('EuPathSiteCommon:apidb', 'EuPathWebSvcCommon:apidb', 'CBIL:gus', 'FgpUtil:gus', 'install:gus', 'WDK:gus', 'WSF:gus');

my @apiProjects = ('EuPathPresenters:apidb', 'EuPathDatasets:apidb', 'ApiCommonShared:apidb', 'ApiCommonWebsite:apidb', 'ApiCommonWebService:apidb', 'GBrowse:apidb', 'ReFlow:gus');

my @orthoProjects = ('OrthoMCLData:apidb', 'OrthoMCLShared:apidb', 'OrthoMCLWebsite:apidb', 'OrthoMCLWebService:apidb');

usage() unless $branch && ($target eq 'api' || $target eq 'ortho' || $target eq 'both');

my @projects;
@projects = (@sharedProjects, @apiProjects) if $target eq 'api';
@projects = (@sharedProjects, @orthoProjects) if $target eq 'ortho';
@projects = (@sharedProjects, @apiProjects, @orthoProjects) if $target eq 'both';


my $url = 'https://www.cbil.upenn.edu/svn';
foreach my $project (@projects) {
  my ($name, $repository) = split(/:/, $project);
  my $subTarget = $branch eq 'trunk'? "trunk" : "branches/$branch";
  my $target = "$url/$repository/$name/$subTarget";
  my $dirName = $name;
  $dirName = "GUS" if $dirName eq 'GusAppFramework';
  my $cmd = "svn co $target $dirName";
  print STDERR "$name\n";
  system($cmd) == 0 || die "Failed checking out '$name'\n";
}

sub usage {
  print STDERR "

Check out a specified branch of the EuPathDB front end software into the current dir.

cd to target \$PROJECT_HOME first (must be empty).

usage: eupathFrontendCheckout trunk|branch_number api|ortho|both

Checks out the following projects:
";
print STDERR "
Shared:
";
  foreach my $project (@sharedProjects) {
    my ($name, $repository) = split(/:/, $project);
    print STDERR "  $name\n";
  }

print STDERR "
Api:
";
  foreach my $project (@apiProjects) {
    my ($name, $repository) = split(/:/, $project);
    print STDERR "  $name\n";
  }
print STDERR "
Ortho:
";
  foreach my $project (@orthoProjects) {
    my ($name, $repository) = split(/:/, $project);
    print STDERR "  $name\n";
  }



exit(1);
}
